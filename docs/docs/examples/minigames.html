<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A sandboxed scripting language for Minecraft event automation">
    <title>Minigame Examples — Quill</title>
    <link rel="stylesheet" href="https://quill.kmathers.co.uk/docs/quilldocs.css">
</head>

<body>
    <div class="particles" id="particles"></div>

    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>
                    <img src="https://raw.githubusercontent.com/KohanMathers/Quill/refs/heads/main/QuillLogo.png"
                        alt="Quill Logo">
                    <a href="../index.html">Quill</a>
                </h2>
                <p class="sidebar-tagline">A sandboxed scripting language for Minecraft event automation</p>
            </div>
            <nav class="sidebar-nav">
                <ul><li class='folder'><span class='folder-name'>advanced</span><ul><li><a href='/docs/advanced/custom-events.html'>Custom Events</a></li><li><a href='/docs/advanced/error-handling.html'>Error Handling</a></li><li><a href='/docs/advanced/persistent-variables.html'>Persistent Variables</a></li><li><a href='/docs/advanced/security.html'>Security</a></li><li><a href='/docs/advanced/subscopes.html'>Subscopes</a></li></ul></li><li class='folder'><span class='folder-name'>api</span><ul><li><a href='/docs/api/constructors.html'>Constructors</a></li><li><a href='/docs/api/player.html'>Player</a></li><li><a href='/docs/api/scope.html'>Scope</a></li><li><a href='/docs/api/utility.html'>Utility</a></li><li><a href='/docs/api/world.html'>World</a></li></ul></li><li class='folder'><span class='folder-name'>commands</span><ul><li><a href='/docs/commands/general.html'>General</a></li><li><a href='/docs/commands/scope-management.html'>Scope Management</a></li><li><a href='/docs/commands/script-management.html'>Script Management</a></li></ul></li><li><a href='/docs/configuration.html'>Configuration</a></li><li class='folder'><span class='folder-name'>developer</span><ul><li><a href='/docs/developer/api-integration.html'>Api Integration</a></li></ul></li><li class='folder'><span class='folder-name'>events</span><ul><li><a href='/docs/events/block-events.html'>Block Events</a></li><li><a href='/docs/events/entity-events.html'>Entity Events</a></li><li><a href='/docs/events/player-events.html'>Player Events</a></li><li><a href='/docs/events/world-events.html'>World Events</a></li></ul></li><li class='folder'><span class='folder-name'>examples</span><ul><li><a href='/docs/examples/basic-scripts.html'>Basic Scripts</a></li><li><a href='/docs/examples/minigames.html' class='active'>Minigames</a></li></ul></li><li><a href='/docs/faq.html'>Faq</a></li><li><a href='/docs/getting-started.html'>Getting Started</a></li><li><a href='/docs/index.html'>Index</a></li><li><a href='/docs/installation.html'>Installation</a></li><li class='folder'><span class='folder-name'>language</span><ul><li><a href='/docs/language/data-types.html'>Data Types</a></li><li><a href='/docs/language/events.html'>Events</a></li><li><a href='/docs/language/functions.html'>Functions</a></li><li><a href='/docs/language/scopes.html'>Scopes</a></li><li><a href='/docs/language/string-interpolation.html'>String Interpolation</a></li><li><a href='/docs/language/syntax.html'>Syntax</a></li></ul></li><li><a href='/docs/quickstart.html'>Quickstart</a></li></ul>
            </nav>
            <div class="sidebar-footer">
                <a class="github-link" href="https://github.com/kohanmathers/quill" target="_blank">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                    </svg>
                    View on GitHub
                </a>
            </div>
        </aside>

        <main class="content">
            <header class="hero hide-hero">
                <img class="hero-logo"
                    src="https://raw.githubusercontent.com/KohanMathers/Quill/refs/heads/main/QuillLogo.png"
                    alt="Quill Logo">
                <h1>Quill</h1>
                <p>A sandboxed scripting language for Minecraft event automation</p>
                <div class="button-group">
                    <a class="ghbutton" href="https://github.com/kohanmathers/quill" target="_blank">View on GitHub</a>
                    <a class="learnmore" href="getting-started.html">Get Started</a>
                </div>
            </header>

            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <a href='../index.html'>Quill</a><span class='separator'>/</span><span>Examples</span><span class='separator'>/</span><span class='current'>Minigames</span>
            </nav>

            <div class="doc-layout">
                <article class="doc-content">
                    <h1 class="page-title">Minigame Examples</h1>
                    <h1 id="minigame-examples">Minigame Examples</h1>
<h2 id="overview">Overview</h2>
<p>These complete minigame examples demonstrate how to build interactive, competitive games using Quill's scripting capabilities. Each example is production-ready and includes full setup instructions.</p>
<p><strong>What You'll Learn:</strong><br />
- Player state management across game sessions<br />
- Score tracking and leaderboards<br />
- Team systems and player grouping<br />
- Arena boundary enforcement<br />
- Game phase management (lobby → active → end)<br />
- Custom win conditions<br />
- Respawn mechanics<br />
- Item management</p>
<p><strong>Requirements:</strong><br />
- Quill plugin installed<br />
- Op permissions to create scopes<br />
- Dedicated arena space for each game<br />
- Basic understanding of Quill scripting</p>
<p><strong>General Pattern:</strong><br />
All minigames follow this structure:<br />
1. <strong>Setup Phase</strong> - Create scope, configure boundaries, set permissions<br />
2. <strong>Script Structure</strong> - Game state, player tracking, event handlers<br />
3. <strong>Game Flow</strong> - Join → Start → Play → End → Reset</p>
<hr />
<h2 id="simple-deathmatch">Simple Deathmatch</h2>
<p>A classic free-for-all PvP arena where players compete for the most kills.</p>
<h3 id="code">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/deathmatch/arena.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Arena configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SPAWN_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SPAWN_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SPAWN_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">GAME_DURATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300000</span><span class="w">  </span><span class="c1">// 5 minutes in milliseconds</span>

<span class="c1">// Game state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// uuid -&gt; {kills: number, deaths: number}</span>

<span class="c1">// Join command</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be in the arena to join!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are already in the game!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">kills</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">deaths</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§aYou joined the deathmatch!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined the game! §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; players)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Auto-start when 2+ players</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!leave&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are not in the game!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="ow">delete</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the deathmatch.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7left the game.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">(</span><span class="s2">&quot;Not enough players&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!start&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">isOp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cGame is already active!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!scores&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">showScoreboard</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Death tracking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerDeath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">killer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">death</span><span class="p">.</span><span class="nx">killer</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w">  </span><span class="c1">// Not in game</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w">  </span><span class="c1">// Game not active</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Record death</span>
<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>

<span class="w">    </span><span class="c1">// Record kill</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>

<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c☠ §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7was killed by §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                  </span><span class="s2">&quot; §8[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;]&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Check win condition</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; won!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c☠ §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7died&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Respawn handling</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerRespawn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Teleport to arena spawn</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">SPAWN_X</span><span class="p">,</span><span class="w"> </span><span class="nx">SPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">SPAWN_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Give equipment</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;iron_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">)</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cooked_beef&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>

<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§aRespawned! Get back in the fight!&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Prevent leaving arena during game</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">newLoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">move</span><span class="p">.</span><span class="nx">to</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">newLoc</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou cannot leave the arena during the game!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Game functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">gameStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l    DEATHMATCH STARTED!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e  First to &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; kills wins!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Give everyone equipment</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">playerObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">playerObj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">playerObj</span><span class="p">.</span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span>
<span class="w">            </span><span class="nx">playerObj</span><span class="p">.</span><span class="nx">foodLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;iron_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cooked_beef&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.player.levelup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Start timer check</span>
<span class="w">    </span><span class="nx">scheduleTimer</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l    GAME OVER!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Show final scores</span>
<span class="w">    </span><span class="nx">showFinalScores</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Clear inventories</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">playerObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">playerObj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">)</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ui.toast.challenge_complete&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Reset for next game</span>
<span class="w">    </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showScoreboard</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6═══ Deathmatch Scores ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Convert to sorted array</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">scores</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Sort by kills (bubble sort)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">kills</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Display top players</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;. §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                   </span><span class="s2">&quot; §7- §c&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills, §8&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">deaths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; deaths&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6═══════════════════════&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showFinalScores</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6═══ Final Scores ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">scores</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">kills</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">scores</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">scores</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scores</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§6🥇&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§7🥈&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;§c🥉&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">medal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §c&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; kills&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">scheduleTimer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check timer every second (implement with periodic event)</span>
<span class="w">    </span><span class="c1">// For simplicity, time limit not enforced in this example</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation">Explanation</h3>
<p><strong>Game State Management:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>

<ul>
<li><code>gameActive</code> - Boolean flag for game state</li>
<li><code>players</code> - Map of UUID → player stats</li>
<li>Tracks kills, deaths, and names per player</li>
</ul>
<p><strong>Join System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be in the arena to join!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<ul>
<li><code>scope.region.contains()</code> - Checks if player is in scope boundaries</li>
<li>Prevents joining from outside arena</li>
<li>Early return pattern for validation</li>
</ul>
<p><strong>Auto-start Logic:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">startGame</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Automatically starts when minimum players reached</li>
<li>Prevents manual start requirement</li>
<li>Checks game isn't already active</li>
</ul>
<p><strong>Death Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
</code></pre></div>

<ul>
<li>Increments death counter for victim</li>
<li>Increments kill counter for killer (if exists)</li>
<li>Validates both players are in game</li>
</ul>
<p><strong>Win Condition:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; won!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Checks if kill threshold reached</li>
<li>Immediately ends game</li>
<li>Prevents further scoring</li>
</ul>
<p><strong>Arena Boundary Enforcement:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">newLoc</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou cannot leave the arena during the game!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Cancels movement outside arena</li>
<li>Only enforced during active game</li>
<li>Prevents escaping</li>
</ul>
<p><strong>Equipment Distribution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">)</span>
<span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;iron_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Clears inventory for fair start</li>
<li>Gives standard loadout</li>
<li>Runs at game start and respawn</li>
</ul>
<h3 id="setup-instructions">Setup Instructions</h3>
<p><strong>1. Create the Arena:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Build a PvP arena with spawn point at (0, 70, 0)</span>
<span class="c1"># Recommended size: 50x50 blocks minimum</span>
<span class="c1"># Include obstacles, cover, and interesting terrain</span>
</code></pre></div>

<p><strong>2. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>deathmatch<span class="w"> </span>YourName<span class="w"> </span>-50<span class="w"> </span><span class="m">60</span><span class="w"> </span>-50<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>3. Grant Required Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>giveItem
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>clearInventory
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>teleport
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>getPlayer
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>deathmatch<span class="w"> </span>playSound
</code></pre></div>

<p><strong>4. Create Script Directory:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/deathmatch
</code></pre></div>

<p><strong>5. Load the Script:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>load<span class="w"> </span>deathmatch/arena.ql
</code></pre></div>

<p><strong>6. Test:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Enter the arena area</span>
!join<span class="w">          </span><span class="c1"># Join the game</span>
!scores<span class="w">        </span><span class="c1"># View scoreboard</span>
!leave<span class="w">         </span><span class="c1"># Leave the game</span>
!start<span class="w">         </span><span class="c1"># (Op only) Force start</span>
</code></pre></div>

<p><strong>7. Adjust Constants:</strong><br />
Edit the script to customize:<br />
- <code>SPAWN_X/Y/Z</code> - Arena spawn point<br />
- <code>KILLS_TO_WIN</code> - Victory threshold<br />
- <code>GAME_DURATION</code> - Time limit<br />
- Equipment loadout in <code>startGame()</code> and respawn handler</p>
<hr />
<h2 id="king-of-the-hill">King of the Hill</h2>
<p>Players compete to control a central capture point for the longest time.</p>
<h3 id="code_1">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/koth/hill.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Hill configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HILL_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HILL_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HILL_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HILL_RADIUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CAPTURE_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">120000</span><span class="w">  </span><span class="c1">// 2 minutes to win</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TICK_INTERVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="w">   </span><span class="c1">// Update every second</span>

<span class="c1">// Game state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// uuid -&gt; {time: number, name: string}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">lastTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>

<span class="c1">// Join system</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be in the arena to join!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are already in the game!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§aYou joined King of the Hill!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined the game!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!leave&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are not in the game!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="ow">delete</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the game.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">(</span><span class="s2">&quot;Not enough players&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!time&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">showTimes</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Hill control tracking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">move</span><span class="p">.</span><span class="nx">to</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if player is on the hill</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">onHill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isOnHill</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">onHill</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Update king if needed</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">oldKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">currentKing</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">oldKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">oldKing</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou lost control of the hill!&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6👑 §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §6captured the hill!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6👑 §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §6captured the hill!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;block.note_block.pling&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Show particles for king</span>
<span class="w">        </span><span class="nx">particle</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;end_rod&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Update timer</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lastTick</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">TICK_INTERVAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">lastTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span>
<span class="w">        </span><span class="nx">updateTimer</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Death handling</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerDeath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7The hill is now uncontested!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Respawn</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerRespawn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Give basic equipment</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stone_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Game functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">lastTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>
<span class="w">    </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">    </span><span class="c1">// Reset all player times</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l   KING OF THE HILL!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Control the hill for §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">CAPTURE_TIME</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s §7to win!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">playerObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">playerObj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stone_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">            </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">updateTimer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Add time to current king</span>
<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">TICK_INTERVAL</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">timeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CAPTURE_TIME</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span>

<span class="w">    </span><span class="c1">// Send progress to king</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">king</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">currentKing</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">king</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">timeRemaining</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">king</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6⏱ Time until victory: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Play sound every 10 seconds</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seconds</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">king</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;block.note_block.hat&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check win condition</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">CAPTURE_TIME</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; won!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l    GAME OVER!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">showFinalTimes</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">playerObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">playerObj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">playerObj</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">isOnHill</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_X</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_Y</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_Z</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dz</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">HILL_RADIUS</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showTimes</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6═══ Hill Control Times ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6Current King: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showFinalTimes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6═══ Final Times ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">times</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Sort by time</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">times</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">times</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">times</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">times</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">times</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§6🥇&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§7🥈&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;§c🥉&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">medal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation_1">Explanation</h3>
<p><strong>Hill Detection:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">func</span><span class="w"> </span><span class="nx">isOnHill</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_X</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_Y</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">HILL_Z</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dz</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">HILL_RADIUS</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Calculates 3D distance from hill center</li>
<li>Uses Euclidean distance formula</li>
<li>Returns true if within radius</li>
<li>Creates spherical capture zone</li>
</ul>
<p><strong>King Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">oldKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">currentKing</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">oldKing</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou lost control of the hill!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">currentKing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Detects king change</li>
<li>Notifies old king of loss</li>
<li>Updates to new king</li>
<li>Broadcasts capture message</li>
</ul>
<p><strong>Time Accumulation:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">func</span><span class="w"> </span><span class="nx">updateTimer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentKing</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">TICK_INTERVAL</span>
</code></pre></div>

<ul>
<li>Only runs if someone controls hill</li>
<li>Adds interval time to king's total</li>
<li>Called every second (TICK_INTERVAL)</li>
<li>Passive time accumulation</li>
</ul>
<p><strong>Visual Feedback:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">particle</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;end_rod&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Spawns particles around king</li>
<li>Creates visual indicator of control</li>
<li>Runs on every movement tick</li>
<li>Helps players identify the hill</li>
</ul>
<p><strong>Progress Updates:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">timeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CAPTURE_TIME</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">currentKing</span><span class="p">].</span><span class="nx">time</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">timeRemaining</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="nx">sendMessage</span><span class="p">(</span><span class="nx">king</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6⏱ Time until victory: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Calculates remaining time</li>
<li>Converts to seconds</li>
<li>Sends to current king only</li>
<li>Updates every second</li>
</ul>
<h3 id="setup-instructions_1">Setup Instructions</h3>
<p><strong>1. Build the Arena:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create an open arena with a raised platform at (0, 70, 0)</span>
<span class="c1"># Hill should be clearly marked (different blocks, beacon, etc.)</span>
<span class="c1"># Recommended: 5-block radius circular platform</span>
<span class="c1"># Add paths and cover around the hill</span>
</code></pre></div>

<p><strong>2. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>koth<span class="w"> </span>YourName<span class="w"> </span>-75<span class="w"> </span><span class="m">60</span><span class="w"> </span>-75<span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">75</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>3. Grant Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>giveItem
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>clearInventory
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>playSound
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>particle
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>koth<span class="w"> </span>getPlayer
</code></pre></div>

<p><strong>4. Load Script:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/koth
/quill<span class="w"> </span>load<span class="w"> </span>koth/hill.ql
</code></pre></div>

<p><strong>5. Test:</strong></p>
<div class="highlight"><pre><span></span><code>!join<span class="w">          </span><span class="c1"># Join game</span>
!time<span class="w">          </span><span class="c1"># Check control times</span>
!leave<span class="w">         </span><span class="c1"># Leave game</span>
</code></pre></div>

<p><strong>6. Customize:</strong><br />
- <code>HILL_X/Y/Z</code> - Hill center coordinates<br />
- <code>HILL_RADIUS</code> - Capture zone size<br />
- <code>CAPTURE_TIME</code> - Time needed to win (milliseconds)<br />
- <code>TICK_INTERVAL</code> - Update frequency</p>
<hr />
<h2 id="parkour-course">Parkour Course</h2>
<p>A timed parkour challenge with checkpoints and leaderboards.</p>
<h3 id="code_2">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/parkour/course.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Course configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">START_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">START_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">START_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">72</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">75</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">40</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">78</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">55</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">35</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">END_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">END_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">82.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">END_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">END_RADIUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span>

<span class="c1">// Player state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">activePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// uuid -&gt; {startTime, checkpoints: []}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">leaderboard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">     </span><span class="c1">// {name, time, date}</span>

<span class="c1">// Start parkour</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!start&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be at the start!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Teleport to start</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">START_X</span><span class="p">,</span><span class="w"> </span><span class="nx">START_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">START_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Initialize player state</span>
<span class="w">        </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">checkpoints</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§a✓ Parkour started! Good luck!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7Checkpoints: §e0§7/§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="w">        </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.player.levelup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!stop&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou haven&#39;t started the parkour!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="ow">delete</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7Parkour attempt cancelled.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!top&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">showLeaderboard</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Checkpoint detection</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">move</span><span class="p">.</span><span class="nx">to</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// Check for next checkpoint</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">length</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">[</span><span class="nx">nextCheckpoint</span><span class="p">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isNear</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">radius</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Hit checkpoint!</span>
<span class="w">            </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">nextCheckpoint</span><span class="p">)</span>

<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§a✓ Checkpoint &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.experience_orb.pickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
<span class="w">            </span><span class="nx">particle</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;happy_villager&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// Show progress</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7Progress: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">progress</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check for finish</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isNear</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">END_X</span><span class="p">,</span><span class="w"> </span><span class="nx">END_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">END_Z</span><span class="p">,</span><span class="w"> </span><span class="nx">END_RADIUS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">finishParkour</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Fall detection</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">move</span><span class="p">.</span><span class="nx">to</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if player fell below threshold</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou fell! Returning to last checkpoint...&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">length</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Return to start</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">START_X</span><span class="p">,</span><span class="w"> </span><span class="nx">START_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">START_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Return to last checkpoint</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastCP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">[</span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">cpLoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">lastCP</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">lastCP</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">lastCP</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">cpLoc</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.enderman.teleport&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Quit handling</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerQuit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="ow">delete</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Helper functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">finishParkour</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">totalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">endTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">startTime</span>

<span class="w">    </span><span class="c1">// Remove from active players</span>
<span class="w">    </span><span class="ow">delete</span><span class="w"> </span><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// Format time</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">totalTime</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">milliseconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">totalTime</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">1000</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">timeString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pad</span><span class="p">(</span><span class="nx">milliseconds</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span>

<span class="w">    </span><span class="c1">// Add to leaderboard</span>
<span class="w">    </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="nx">totalTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timeString</span><span class="o">:</span><span class="w"> </span><span class="nx">timeString</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentDate</span><span class="p">()</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// Sort leaderboard</span>
<span class="w">    </span><span class="nx">sortLeaderboard</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Announce completion</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6✦ §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7completed the parkour in §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timeString</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§7!&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Check if personal best</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerRank</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6★ New top 3 time! Rank #&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rank</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Rewards</span>
<span class="w">    </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ui.toast.challenge_complete&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">    </span><span class="nx">particle</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;totem_of_undying&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>

<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6§l═══════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§e  Course Complete!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7  Time: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">timeString</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7  Rank: §e#&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rank</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6§l═══════════════════&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">isNear</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">x</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">y</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">z</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dz</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">distance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">radius</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showLeaderboard</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6═══ Parkour Leaderboard ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7No times recorded yet!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§6🥇&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§7🥈&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§c🥉&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">timeString</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6══════════════════════════&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">sortLeaderboard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerRank</span><span class="p">(</span><span class="nx">playerName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">playerName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">pad</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">str</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">str</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getCurrentDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;2024-01-01&quot;</span><span class="w">  </span><span class="c1">// Simplified - implement actual date retrieval</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation_2">Explanation</h3>
<p><strong>Checkpoint System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">72</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">75</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">]</span>
</code></pre></div>

<ul>
<li>Array of checkpoint objects</li>
<li>Each has position and trigger radius</li>
<li>Must be hit in order</li>
<li>Tracks player progress through course</li>
</ul>
<p><strong>State Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">activePlayers</span><span class="p">[</span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">checkpoints</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>startTime</code> - When player started (for timing)</li>
<li><code>checkpoints</code> - Array of completed checkpoint indices</li>
<li><code>name</code> - Player name for leaderboard</li>
<li>Persistent during run, deleted on finish/quit</li>
</ul>
<p><strong>Sequential Checkpoint Detection:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">length</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">nextCheckpoint</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">[</span><span class="nx">nextCheckpoint</span><span class="p">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isNear</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="nx">cp</span><span class="p">.</span><span class="nx">radius</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">nextCheckpoint</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><code>nextCheckpoint</code> = number of completed checkpoints</li>
<li>Only checks the next expected checkpoint</li>
<li>Prevents skipping ahead</li>
<li>Adds to array when hit</li>
</ul>
<p><strong>Fall Recovery:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">checkpoints</span><span class="p">.</span><span class="nx">length</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Return to start</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Return to last checkpoint</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastCP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CHECKPOINTS</span><span class="p">[</span><span class="nx">checkpointCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
</code></pre></div>

<ul>
<li>Detects when player falls below Y threshold</li>
<li>Returns to start if no checkpoints hit</li>
<li>Returns to last checkpoint otherwise</li>
<li>Preserves progress through course</li>
</ul>
<p><strong>Time Calculation:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">totalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">endTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">startTime</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">totalTime</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">milliseconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">totalTime</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">1000</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">timeString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pad</span><span class="p">(</span><span class="nx">milliseconds</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;s&quot;</span>
</code></pre></div>

<ul>
<li>Calculates elapsed time in milliseconds</li>
<li>Converts to seconds and milliseconds</li>
<li>Formats as "12.345s" for display</li>
<li>Accurate to millisecond</li>
</ul>
<p><strong>Leaderboard Management:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="nx">totalTime</span><span class="p">,</span>
<span class="w">    </span><span class="nx">timeString</span><span class="o">:</span><span class="w"> </span><span class="nx">timeString</span><span class="p">,</span>
<span class="w">    </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentDate</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">sortLeaderboard</span><span class="p">()</span>
</code></pre></div>

<ul>
<li>Adds new completion to leaderboard</li>
<li>Stores both raw time and formatted string</li>
<li>Re-sorts after each addition</li>
<li>Keeps all times (could limit to top N)</li>
</ul>
<p><strong>Ranking System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerRank</span><span class="p">(</span><span class="nx">playerName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">playerName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Finds player's position in sorted leaderboard</li>
<li>Returns 1-based rank (1st, 2nd, 3rd...)</li>
<li>Used for completion announcements</li>
<li>Handles player not found case</li>
</ul>
<h3 id="setup-instructions_2">Setup Instructions</h3>
<p><strong>1. Build the Course:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create parkour jumps from (0,70,0) to (70,82,50)</span>
<span class="c1"># Place pressure plates or colored blocks at checkpoint locations</span>
<span class="c1"># Mark start clearly (beacon, signs, etc.)</span>
<span class="c1"># Mark finish line distinctly</span>
<span class="c1"># Add barriers or void below to catch falls</span>
</code></pre></div>

<p><strong>2. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>parkour<span class="w"> </span>YourName<span class="w"> </span>-10<span class="w"> </span><span class="m">60</span><span class="w"> </span>-10<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">60</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>3. Grant Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>parkour<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>parkour<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>parkour<span class="w"> </span>teleport
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>parkour<span class="w"> </span>playSound
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>parkour<span class="w"> </span>particle
</code></pre></div>

<p><strong>4. Load Script:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/parkour
/quill<span class="w"> </span>load<span class="w"> </span>parkour/course.ql
</code></pre></div>

<p><strong>5. Test:</strong></p>
<div class="highlight"><pre><span></span><code>!start<span class="w">         </span><span class="c1"># Start parkour timer</span>
<span class="c1"># Complete the course, hitting checkpoints in order</span>
!stop<span class="w">          </span><span class="c1"># Cancel attempt</span>
!top<span class="w">           </span><span class="c1"># View leaderboard</span>
</code></pre></div>

<p><strong>6. Customize:</strong><br />
- Adjust <code>CHECKPOINTS</code> array to match your course layout<br />
- Change <code>START_X/Y/Z</code> to your start location<br />
- Modify <code>END_X/Y/Z/RADIUS</code> for finish line<br />
- Adjust fall threshold (currently Y &lt; 60)</p>
<hr />
<h2 id="team-battle-arena">Team Battle Arena</h2>
<p>Two teams compete in objective-based combat with respawns and team scoring.</p>
<h3 id="code_3">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/teambattle/arena.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Team configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RED_SPAWN_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">20.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RED_SPAWN_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RED_SPAWN_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">BLUE_SPAWN_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RESPAWN_DELAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="w">  </span><span class="c1">// 3 seconds</span>

<span class="c1">// Game state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">redTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">   </span><span class="c1">// uuid -&gt; {name, kills, deaths}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">blueTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">respawnQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w">  </span><span class="c1">// {uuid, time, team}</span>

<span class="c1">// Team assignment</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join red&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are already on a team!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">kills</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">deaths</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§c✓ You joined the Red Team!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined §cRed Team §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; players)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join blue&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are already on a team!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">kills</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">deaths</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§9✓ You joined the Blue Team!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined §9Blue Team §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; players)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!leave&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="ow">delete</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the Red Team.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="ow">delete</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the Blue Team.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are not on a team!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">(</span><span class="s2">&quot;A team ran out of players!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!scores&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">showScores</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Combat tracking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerDeath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">killer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">death</span><span class="p">.</span><span class="nx">killer</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">victimUUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">victim</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">victimUUID</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Record death</span>
<span class="w">    </span><span class="nx">victimTeam</span><span class="p">[</span><span class="nx">victimUUID</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">victimTeam</span><span class="p">[</span><span class="nx">victimUUID</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>

<span class="w">    </span><span class="c1">// Add to respawn queue</span>
<span class="w">    </span><span class="nx">respawnQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">        </span><span class="nx">uuid</span><span class="o">:</span><span class="w"> </span><span class="nx">victimUUID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RESPAWN_DELAY</span><span class="p">,</span>
<span class="w">        </span><span class="nx">team</span><span class="o">:</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redTeam</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// Record kill and update score</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">killerUUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">killer</span><span class="p">.</span><span class="nx">uuid</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">killerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">killerUUID</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killerTeam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">killerTeam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">victimTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">killerTeam</span><span class="p">[</span><span class="nx">killerUUID</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">killerTeam</span><span class="p">[</span><span class="nx">killerUUID</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killerTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">redScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">                </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c⚔ &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7killed §9&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">victim</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                         </span><span class="s2">&quot; §8[§cRed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7vs §9Blue: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§8]&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">                </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§9⚔ &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7killed §c&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">victim</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                         </span><span class="s2">&quot; §8[§cRed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7vs §9Blue: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§8]&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// Check win condition</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">redScore</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">endGame</span><span class="p">(</span><span class="s2">&quot;§cRed Team wins!&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">blueScore</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">endGame</span><span class="p">(</span><span class="s2">&quot;§9Blue Team wins!&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Respawn system (check periodically)</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">newQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">respawnQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">respawnQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Time to respawn</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">respawnPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">team</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Keep in queue</span>
<span class="w">            </span><span class="nx">newQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">respawnQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newQueue</span>
<span class="p">}</span>

<span class="c1">// Friendly fire prevention</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">damage</span><span class="p">.</span><span class="nx">target</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">attacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">damage</span><span class="p">.</span><span class="nx">source</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">victim</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">attacker</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">victim</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">attackerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">attacker</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">attackerTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">attacker</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou cannot damage teammates!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Game functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">redScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>

<span class="w">    </span><span class="c1">// Reset player stats</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">kills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l   TEAM BATTLE START!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  §cRed §7vs §9Blue&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  First to §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills wins!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Spawn all players</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">respawnPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">respawnPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">respawnPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">team</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Teleport to team spawn</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">spawn</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">team</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">RED_SPAWN_X</span><span class="p">,</span><span class="w"> </span><span class="nx">RED_SPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">RED_SPAWN_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">BLUE_SPAWN_X</span><span class="p">,</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Heal and feed</span>
<span class="w">    </span><span class="nx">player</span><span class="p">.</span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span>
<span class="w">    </span><span class="nx">player</span><span class="p">.</span><span class="nx">foodLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>

<span class="w">    </span><span class="c1">// Clear inventory</span>
<span class="w">    </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Give team equipment</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">team</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;iron_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">64</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cooked_beef&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Red leather armor would go here</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;iron_sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;arrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">64</span><span class="p">)</span>
<span class="w">        </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cooked_beef&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Blue leather armor would go here</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.player.levelup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§aRespawned!&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">endGame</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">respawnQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l    GAME OVER!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">showFinalStats</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Clear all inventories</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Reset teams</span>
<span class="w">    </span><span class="nx">redTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">blueTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showScores</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§e═══ Team Battle Scores ═══&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cRed Team: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§9Blue Team: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7Target: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">KILLS_TO_WIN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showFinalStats</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e═══ Final Statistics ═══&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§cRed Team: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;  §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§7/§8&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">deaths</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§9Blue Team: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7kills&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;  §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">kills</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§7/§8&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">deaths</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">redTeam</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">blueTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">blueTeam</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getTeamSize</span><span class="p">(</span><span class="nx">team</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">team</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation_3">Explanation</h3>
<p><strong>Team Data Structure:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">redTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">   </span><span class="c1">// uuid -&gt; {name, kills, deaths}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">blueTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
</code></pre></div>

<ul>
<li>Two separate maps for teams</li>
<li>Tracks individual player stats</li>
<li>Separate team scores for win condition</li>
<li>UUID-based to handle name changes</li>
</ul>
<p><strong>Team Assignment:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join red&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">redTeam</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">kills</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">deaths</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<ul>
<li>Adds player to team map</li>
<li>Initializes stats to zero</li>
<li>Prevents joining if already on a team</li>
<li>Auto-starts when both teams have 2+ players</li>
</ul>
<p><strong>Respawn Queue System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">respawnQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">uuid</span><span class="o">:</span><span class="w"> </span><span class="nx">victimUUID</span><span class="p">,</span>
<span class="w">    </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RESPAWN_DELAY</span><span class="p">,</span>
<span class="w">    </span><span class="nx">team</span><span class="o">:</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redTeam</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span>
<span class="p">})</span>
</code></pre></div>

<ul>
<li>Adds dead player to queue with respawn time</li>
<li>Includes team info for correct spawn point</li>
<li>Processed every tick in PlayerMove event</li>
<li>Respawns when current time &gt;= respawn time</li>
</ul>
<p><strong>Friendly Fire Prevention:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">victim</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">attackerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayerTeam</span><span class="p">(</span><span class="nx">attacker</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">victimTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">attackerTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Checks if both players on same team</li>
<li>Cancels damage event if teammates</li>
<li>Sends warning message to attacker</li>
<li>Prevents team killing</li>
</ul>
<p><strong>Team-Specific Spawning:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">team</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">RED_SPAWN_X</span><span class="p">,</span><span class="w"> </span><span class="nx">RED_SPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">RED_SPAWN_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">BLUE_SPAWN_X</span><span class="p">,</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="nx">BLUE_SPAWN_Z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Different spawn points per team</li>
<li>Ensures teams start separated</li>
<li>Maintains team positioning</li>
<li>Could add team-colored armor here</li>
</ul>
<p><strong>Score Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">killerTeam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redTeam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">redScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c⚔ &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">killer</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7killed §9&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">victim</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">             </span><span class="s2">&quot; §8[§cRed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">redScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7vs §9Blue: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">blueScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;§8]&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Increments team score on kill</li>
<li>Broadcasts with team colors</li>
<li>Shows current score in kill message</li>
<li>Checks win condition after each kill</li>
</ul>
<h3 id="setup-instructions_3">Setup Instructions</h3>
<p><strong>1. Build Team Arena:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create two bases at (-20,70,0) and (20,70,0)</span>
<span class="c1"># Add team-colored blocks (red wool vs blue wool)</span>
<span class="c1"># Create a central combat zone</span>
<span class="c1"># Build obstacles and cover</span>
<span class="c1"># Mark spawn points clearly</span>
</code></pre></div>

<p><strong>2. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>teambattle<span class="w"> </span>YourName<span class="w"> </span>-50<span class="w"> </span><span class="m">60</span><span class="w"> </span>-50<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>3. Grant Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>giveItem
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>clearInventory
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>teleport
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>getPlayer
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>teambattle<span class="w"> </span>playSound
</code></pre></div>

<p><strong>4. Load Script:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/teambattle
/quill<span class="w"> </span>load<span class="w"> </span>teambattle/arena.ql
</code></pre></div>

<p><strong>5. Test:</strong></p>
<div class="highlight"><pre><span></span><code>!join<span class="w"> </span>red<span class="w">      </span><span class="c1"># Join red team</span>
!join<span class="w"> </span>blue<span class="w">     </span><span class="c1"># Join blue team</span>
!scores<span class="w">        </span><span class="c1"># View current scores</span>
!leave<span class="w">         </span><span class="c1"># Leave your team</span>
</code></pre></div>

<p><strong>6. Customize:</strong><br />
- Adjust spawn coordinates for your arena<br />
- Change <code>KILLS_TO_WIN</code> for longer/shorter games<br />
- Modify <code>RESPAWN_DELAY</code> for faster/slower respawns<br />
- Customize equipment loadouts in <code>respawnPlayer()</code><br />
- Add team-colored leather armor</p>
<hr />
<h2 id="spleef-game">Spleef Game</h2>
<p>Players break blocks beneath each other, last one standing wins.</p>
<h3 id="code_4">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/spleef/game.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Arena configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FLOOR_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">70.0</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FLOOR_MATERIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;snow_block&quot;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RESPAWN_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">75.0</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">LOBBY_WAIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10000</span><span class="w">  </span><span class="c1">// 10 seconds</span>

<span class="c1">// Game state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">lobbyStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// uuid -&gt; {name, alive, wins}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">brokenBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="c1">// Join lobby</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cGame in progress! Wait for it to finish.&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be in the arena!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou already joined!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">alive</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">wins</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§a✓ You joined Spleef!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined! §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; players)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Start lobby countdown</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startLobby</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!leave&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou haven&#39;t joined!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the game.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cancelLobby</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!wins&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">showWins</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Block breaking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">BlockBreak</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">block</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Only allow breaking floor blocks</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">FLOOR_Y</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">FLOOR_MATERIAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Track broken block for restoration</span>
<span class="w">    </span><span class="nx">brokenBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">        </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
<span class="w">        </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
<span class="w">        </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// Prevent block drop</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">setType</span><span class="p">(</span><span class="s2">&quot;air&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Fall detection</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">move</span><span class="p">.</span><span class="nx">to</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Lobby countdown display</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lobbyActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">LOBBY_WAIT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lobbyStartTime</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">remaining</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§e⏱ Starting in &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if player fell</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">FLOOR_Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Player eliminated!</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c✗ §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7fell! §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; remaining)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou were eliminated!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.player.hurt&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Spectator mode</span>
<span class="w">        </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">RESPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">))</span>

<span class="w">        </span><span class="c1">// Check win condition</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endGame</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Lobby system</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startLobby</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">lobbyStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e  SPLEEF STARTING!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Get ready...&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Schedule game start</span>
<span class="w">    </span><span class="nx">scheduleGameStart</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">scheduleGameStart</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This would be called after LOBBY_WAIT</span>
<span class="w">    </span><span class="c1">// For simplicity, check in PlayerMove</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">cancelLobby</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§cLobby cancelled - not enough players!&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Game functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lobbyActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§cNot enough players to start!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">brokenBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l  SPLEEF BEGIN!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Break blocks beneath&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  your opponents!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§a§l═══════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Teleport all players to arena</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">teleport</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">RESPAWN_Y</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">                </span><span class="nx">giveItem</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;diamond_shovel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">                </span><span class="nx">player</span><span class="p">.</span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span>
<span class="w">                </span><span class="nx">player</span><span class="p">.</span><span class="nx">foodLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<span class="w">                </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.player.levelup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Check if lobby should start game</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lobbyStartTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">LOBBY_WAIT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">startGame</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">endGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">    </span><span class="c1">// Find winner</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">            </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">winner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">winner</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; WINS!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Total wins: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">winner</span><span class="p">.</span><span class="nx">wins</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">winnerPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">winner</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">winnerPlayer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">winnerPlayer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ui.toast.challenge_complete&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">            </span><span class="nx">particle</span><span class="p">(</span><span class="nx">winnerPlayer</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;totem_of_undying&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7Game ended - no winner!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Restore floor</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">brokenBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">brokenBlocks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">setBlock</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Clear inventories</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Reset for next game</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">brokenBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showWins</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6═══ Spleef Champions ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Sort by wins</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">leaderboard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">])</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">wins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7No wins recorded yet!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">leaderboard</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§6🥇&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§7🥈&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§c🥉&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">wins</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; wins&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation_4">Explanation</h3>
<p><strong>Floor Material Restriction:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">FLOOR_Y</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">FLOOR_MATERIAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">setCancelled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Only allows breaking blocks at floor level</li>
<li>Only allows breaking the designated material</li>
<li>Prevents griefing arena structure</li>
<li>Keeps game focused on floor breaking</li>
</ul>
<p><strong>Block Tracking for Restoration:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">brokenBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
<span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
<span class="w">    </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span>
<span class="p">})</span>
</code></pre></div>

<ul>
<li>Records every broken block's location and type</li>
<li>Allows complete floor restoration after game</li>
<li>Essential for repeated games</li>
<li>Prevents permanent arena damage</li>
</ul>
<p><strong>Lobby System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">func</span><span class="w"> </span><span class="nx">startLobby</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">lobbyActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">lobbyStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Countdown period before game starts</li>
<li>Gives players time to join</li>
<li>Prevents instant start with minimal players</li>
<li>Can be cancelled if players leave</li>
</ul>
<p><strong>Elimination Detection:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">FLOOR_Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c✗ §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7fell! §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getAliveCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; remaining)&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Checks if player fell below floor</li>
<li>Marks as eliminated (not removed from game)</li>
<li>Broadcasts elimination to all players</li>
<li>Shows remaining player count</li>
</ul>
<p><strong>Win Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">wins</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
</code></pre></div>

<ul>
<li>Persistent across multiple games</li>
<li>Creates leaderboard system</li>
<li>Encourages repeated play</li>
<li>Tracks career statistics</li>
</ul>
<p><strong>Floor Restoration:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">brokenBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">brokenBlocks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">setBlock</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Loops through all broken blocks</li>
<li>Restores each to original type</li>
<li>Runs after every game</li>
<li>Resets arena for next round</li>
</ul>
<h3 id="setup-instructions_4">Setup Instructions</h3>
<p><strong>1. Build Spleef Arena:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a flat platform at Y=70 with snow blocks</span>
<span class="c1"># Recommended size: 20x20 or larger</span>
<span class="c1"># Add barriers around edges (glass walls)</span>
<span class="c1"># Place spectator platform at Y=75</span>
<span class="c1"># Add void or water pit below Y=68 to catch fallen players</span>
</code></pre></div>

<p><strong>2. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>spleef<span class="w"> </span>YourName<span class="w"> </span>-30<span class="w"> </span><span class="m">65</span><span class="w"> </span>-30<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">30</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>3. Grant Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>giveItem
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>clearInventory
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>teleport
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>getPlayer
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>playSound
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>particle
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>spleef<span class="w"> </span>setBlock
</code></pre></div>

<p><strong>4. Load Script:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/spleef
/quill<span class="w"> </span>load<span class="w"> </span>spleef/game.ql
</code></pre></div>

<p><strong>5. Test:</strong></p>
<div class="highlight"><pre><span></span><code>!join<span class="w">          </span><span class="c1"># Join game</span>
!wins<span class="w">          </span><span class="c1"># View leaderboard</span>
!leave<span class="w">         </span><span class="c1"># Leave game</span>
<span class="c1"># Game auto-starts after 10 seconds with 2+ players</span>
</code></pre></div>

<p><strong>6. Customize:</strong><br />
- Change <code>FLOOR_Y</code> to match your arena height<br />
- Adjust <code>FLOOR_MATERIAL</code> to desired block type<br />
- Modify <code>MIN_PLAYERS</code> for player requirements<br />
- Change <code>LOBBY_WAIT</code> for countdown duration</p>
<hr />
<h2 id="treasure-hunt">Treasure Hunt</h2>
<p>Players search for hidden items within a time limit, most valuable collection wins.</p>
<h3 id="code_5">Code</h3>
<p><strong>File:</strong> <code>plugins/Quill/scripts/treasure/hunt.ql</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Hunt configuration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HUNT_DURATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">180000</span><span class="w">  </span><span class="c1">// 3 minutes</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">TREASURE_VALUES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;gold_ingot&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;diamond&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;emerald&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;nether_star&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;golden_apple&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;enchanted_golden_apple&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">75</span>
<span class="p">}</span>

<span class="c1">// Spawn locations for treasures (randomize from these)</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">70</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">15</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">72</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">68</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">10</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">71</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">20</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">69</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">70</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">25</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">74</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>

<span class="c1">// Game state</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">gameStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// uuid -&gt; {name, score, inventory}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">spawnedTreasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="c1">// Join system</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerChat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">message</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!join&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cHunt already in progress!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou must be in the hunt area!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou already joined!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">inventory</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§a✓ You joined the treasure hunt!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7joined! §8(&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; hunters)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">MIN_PLAYERS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">startHunt</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!leave&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou haven&#39;t joined!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="ow">delete</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§7You left the hunt.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">endHunt</span><span class="p">(</span><span class="s2">&quot;All players left!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!score&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cYou are not in the hunt!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6Your score: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; points&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!start&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">isOp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§cHunt already active!&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">startHunt</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Pickup tracking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerPickupItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">item</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if it&#39;s treasure</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">itemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">type</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TREASURE_VALUES</span><span class="p">[</span><span class="nx">itemType</span><span class="p">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// It&#39;s treasure!</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">value</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemType</span><span class="p">)</span>

<span class="w">        </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;§6✦ Found treasure! §e+&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; points §8(Total: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                   </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;entity.experience_orb.pickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Remove from spawned list</span>
<span class="w">        </span><span class="nx">removeSpawnedTreasure</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Time tracking</span>
<span class="nx">OnEvent</span><span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">gameActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">player</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">player</span><span class="p">.</span><span class="nx">uuid</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check time remaining</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gameStartTime</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HUNT_DURATION</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">elapsed</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">remaining</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">endHunt</span><span class="p">(</span><span class="s2">&quot;Time&#39;s up!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Show countdown every 30 seconds</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">remaining</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seconds</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">180</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e⏱ &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; seconds remaining!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Final countdown</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">seconds</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§c&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;!&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;block.note_block.hat&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Game functions</span>
<span class="nx">func</span><span class="w"> </span><span class="nx">startHunt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">gameStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Reset player scores</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l  TREASURE HUNT START!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Find treasures for points!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  Time limit: §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">HUNT_DURATION</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; seconds&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Clear inventories</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">            </span><span class="nx">player</span><span class="p">.</span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span>
<span class="w">            </span><span class="nx">player</span><span class="p">.</span><span class="nx">foodLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Spawn treasures</span>
<span class="w">    </span><span class="nx">spawnTreasures</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">spawnTreasures</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">spawnedTreasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="c1">// Spawn multiple treasures of each type</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">treasureTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;gold_ingot&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;diamond&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;emerald&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;golden_apple&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">treasureTypes</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">treasureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">treasureTypes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

<span class="w">        </span><span class="c1">// Spawn 3-5 of each type</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Pick random location</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">locIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">[</span><span class="nx">locIndex</span><span class="p">]</span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">spawn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// Spawn treasure item</span>
<span class="w">            </span><span class="nx">spawnItem</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">treasureType</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>

<span class="w">            </span><span class="nx">spawnedTreasure</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">                </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
<span class="w">                </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
<span class="w">                </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
<span class="w">                </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">treasureType</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Spawn rare treasures (fewer of these)</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">rareTreasures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nether_star&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;enchanted_golden_apple&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">rareTreasures</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">treasureType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rareTreasures</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

<span class="w">        </span><span class="c1">// Only 1-2 of each rare type</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">locIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">[</span><span class="nx">locIndex</span><span class="p">]</span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">location</span><span class="p">(</span><span class="nx">spawn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">spawnItem</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span><span class="w"> </span><span class="nx">treasureType</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>

<span class="w">            </span><span class="nx">spawnedTreasure</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">                </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
<span class="w">                </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
<span class="w">                </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
<span class="w">                </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">treasureType</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e✦ &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">spawnedTreasure</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; treasures have been hidden!&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">endHunt</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">gameActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§e§l    HUNT COMPLETE!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§7  &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6§l═══════════════════════&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">showResults</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Clear inventories</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInventory</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Reset for next game</span>
<span class="w">    </span><span class="nx">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">spawnedTreasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">showResults</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6═══ Final Results ═══&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Sort by score</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">score</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
<span class="w">                </span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span>
<span class="w">                </span><span class="nx">results</span><span class="p">[</span><span class="nx">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">temp</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Show top 3</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">medal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§6🥇&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;§7🥈&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;§c🥉&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">medal</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §f&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; §7- §e&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; points&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Award winner</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPlayer</span><span class="p">(</span><span class="nx">getUUIDByName</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">winner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">playSound</span><span class="p">(</span><span class="nx">winner</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ui.toast.challenge_complete&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="w">                </span><span class="nx">particle</span><span class="p">(</span><span class="nx">winner</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;totem_of_undying&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">broadcast</span><span class="p">(</span><span class="s2">&quot;§6══════════════════&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">removeSpawnedTreasure</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">newList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">spawnedTreasure</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">treasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">spawnedTreasure</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">treasure</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">treasure</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">treasure</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">loc</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">newList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">treasure</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">spawnedTreasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newList</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getPlayerCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>

<span class="nx">func</span><span class="w"> </span><span class="nx">getUUIDByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">players</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">uuid</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="explanation_5">Explanation</h3>
<p><strong>Value System:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">TREASURE_VALUES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;gold_ingot&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;diamond&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;emerald&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;nether_star&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Maps item types to point values</li>
<li>Creates rarity system (higher value = rarer)</li>
<li>Makes strategic choices meaningful</li>
<li>Balances gameplay (risk vs reward)</li>
</ul>
<p><strong>Random Spawning:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">locIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="p">[</span><span class="nx">locIndex</span><span class="p">]</span>
</code></pre></div>

<ul>
<li>Picks random location from predefined list</li>
<li><code>Math.random()</code> returns 0.0 to 1.0</li>
<li><code>Math.floor()</code> converts to integer index</li>
<li>Creates different hunt each game</li>
</ul>
<p><strong>Score Calculation:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TREASURE_VALUES</span><span class="p">[</span><span class="nx">itemType</span><span class="p">]</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">players</span><span class="p">[</span><span class="nx">uuid</span><span class="p">].</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">value</span>
</code></pre></div>

<ul>
<li>Looks up item value in map</li>
<li>Only awards points for designated treasures</li>
<li>Ignores non-treasure items</li>
<li>Real-time score updating</li>
</ul>
<p><strong>Time Management:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">millis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">gameStartTime</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">HUNT_DURATION</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">elapsed</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">remaining</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">endHunt</span><span class="p">(</span><span class="s2">&quot;Time&#39;s up!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Calculates time remaining</li>
<li>Automatically ends when time expires</li>
<li>Checked on every player movement</li>
<li>Ensures consistent time limit</li>
</ul>
<p><strong>Rarity Distribution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Common treasures: 3-5 spawns</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span>

<span class="c1">// Rare treasures: 1-2 spawns</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Common items spawn more frequently</li>
<li>Rare items spawn less frequently</li>
<li>Adds variety to each hunt</li>
<li>Creates competitive advantage for finding rare items</li>
</ul>
<p><strong>Treasure Tracking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">spawnedTreasure</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
<span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
<span class="w">    </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="nx">spawn</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">treasureType</span>
<span class="p">})</span>
</code></pre></div>

<ul>
<li>Records all spawned treasure locations</li>
<li>Allows validation of pickups</li>
<li>Enables cleanup after game</li>
<li>Tracks remaining treasures (optional feature)</li>
</ul>
<h3 id="setup-instructions_5">Setup Instructions</h3>
<p><strong>1. Build Hunt Area:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create varied terrain with hiding spots</span>
<span class="c1"># Add buildings, caves, trees, rocks for treasure placement</span>
<span class="c1"># Mark spawn locations with subtle indicators</span>
<span class="c1"># Ensure area is interesting but not too large</span>
<span class="c1"># Recommended size: 50x50 blocks</span>
</code></pre></div>

<p><strong>2. Configure Spawn Locations:</strong><br />
Edit the <code>SPAWN_LOCATIONS</code> array to match your arena:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">SPAWN_LOCATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">70</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="p">},</span><span class="w">   </span><span class="c1">// Behind red building</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">15</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">72</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="p">},</span><span class="w">  </span><span class="c1">// In tree</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">68</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">10</span><span class="w"> </span><span class="p">},</span><span class="w">  </span><span class="c1">// Under bridge</span>
<span class="w">    </span><span class="c1">// Add more locations</span>
<span class="p">]</span>
</code></pre></div>

<p><strong>3. Create Scope:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>create<span class="w"> </span>treasure<span class="w"> </span>YourName<span class="w"> </span>-50<span class="w"> </span><span class="m">60</span><span class="w"> </span>-50<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>whitelist
</code></pre></div>

<p><strong>4. Grant Permissions:</strong></p>
<div class="highlight"><pre><span></span><code>/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>broadcast
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>sendMessage
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>clearInventory
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>getPlayer
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>playSound
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>particle
/quill<span class="w"> </span>scope<span class="w"> </span>permission<span class="w"> </span>grant<span class="w"> </span>treasure<span class="w"> </span>spawnItem
</code></pre></div>

<p><strong>5. Load Script:</strong></p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>plugins/Quill/scripts/treasure
/quill<span class="w"> </span>load<span class="w"> </span>treasure/hunt.ql
</code></pre></div>

<p><strong>6. Test:</strong></p>
<div class="highlight"><pre><span></span><code>!join<span class="w">          </span><span class="c1"># Join hunt</span>
!score<span class="w">         </span><span class="c1"># Check your score</span>
!start<span class="w">         </span><span class="c1"># (Op) Force start</span>
!leave<span class="w">         </span><span class="c1"># Leave hunt</span>
<span class="c1"># Game auto-starts with 2+ players</span>
</code></pre></div>

<p><strong>7. Customize:</strong><br />
- Adjust <code>TREASURE_VALUES</code> for different point distributions<br />
- Modify <code>HUNT_DURATION</code> for longer/shorter hunts<br />
- Add more treasure types to the value map<br />
- Customize spawn locations to match your build<br />
- Adjust spawn counts for common/rare treasures</p>
<hr />
<h2 id="best-practices-for-minigames">Best Practices for Minigames</h2>
<p><strong>General Tips:</strong><br />
1. <strong>Always Test Thoroughly</strong> - Play through multiple rounds before release<br />
2. <strong>Clear Instructions</strong> - Use <code>!help</code> commands to explain rules<br />
3. <strong>Fair Balancing</strong> - Playtest with multiple players to ensure balance<br />
4. <strong>Error Handling</strong> - Handle edge cases (players leaving, disconnects)<br />
5. <strong>Performance</strong> - Avoid heavy operations in high-frequency events<br />
6. <strong>Visual Feedback</strong> - Use sounds, particles, and messages effectively<br />
7. <strong>Reset Properly</strong> - Ensure complete cleanup between games<br />
8. <strong>Save Progress</strong> - Use persistent variables for leaderboards<br />
9. <strong>Spectator Mode</strong> - Allow eliminated players to watch<br />
10. <strong>Documentation</strong> - Comment your code for future modifications</p>
<p><strong>Common Issues:</strong><br />
- <strong>Memory Leaks</strong> - Always clean up player data when they leave<br />
- <strong>Scope Boundaries</strong> - Ensure arena is fully within scope<br />
- <strong>Permissions</strong> - Grant all needed permissions before testing<br />
- <strong>Concurrent Games</strong> - Handle multiple game instances if needed<br />
- <strong>Player Disconnects</strong> - Remove disconnected players from active games</p>
<p><strong>Enhancement Ideas:</strong><br />
- Add cosmetic rewards for winners<br />
- Implement seasons or ranked modes<br />
- Create tournament brackets<br />
- Add power-ups or special abilities<br />
- Include spectator chat channel<br />
- Record and display statistics<br />
- Add achievements system<br />
- Create custom items or equipment</p>
<p><strong>Community Engagement:</strong><br />
- Host regular events with your minigames<br />
- Create leaderboards that reset monthly<br />
- Offer prizes for top players<br />
- Get player feedback for improvements<br />
- Share your minigames with the Quill community</p>

                    <div class="page-meta">
                        <span class="last-modified">Last updated: November 15, 2025</span>
                    </div>
                </article>

                <nav class='toc'><h4>On This Page</h4><ul><li style='margin-left:0px'><a href='#overview'>Overview</a></li><li style='margin-left:0px'><a href='#simple-deathmatch'>Simple Deathmatch</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#king-of-the-hill'>King of the Hill</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#parkour-course'>Parkour Course</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#team-battle-arena'>Team Battle Arena</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#spleef-game'>Spleef Game</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#treasure-hunt'>Treasure Hunt</a></li><li style='margin-left:20px'><a href='#code'>Code</a></li><li style='margin-left:20px'><a href='#explanation'>Explanation</a></li><li style='margin-left:20px'><a href='#setup-instructions'>Setup Instructions</a></li><li style='margin-left:0px'><a href='#best-practices-for-minigames'>Best Practices for Minigames</a></li></ul></nav>
            </div>

            <footer class="doc-footer">
                <div class="footer-content">
                    <div class="alpha-banner">Quill — A sandboxed scripting language for Minecraft event automation</div>
                    <div class="footer-links">
                        <a href="https://github.com/kohanmathers/quill/issues" target="_blank">Report Issue</a>
                        <span class="separator">•</span>
                        <a href="https://github.com/kohanmathers/quill/blob/main/LICENSE" target="_blank">License</a>
                        <span class="separator">•</span>
                        <a href="https://github.com/kohanmathers/quill" target="_blank">Contribute</a>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <script>
        function createParticles() {
            const particles = document.getElementById('particles');
            const symbols = ['fn', 'let', 'if', '{}', '()', '=>', '[]', '&&', '||', '==', '!='];
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                particles.appendChild(particle);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            createParticles();

            document.querySelectorAll('.toc a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });

            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    const id = entry.target.getAttribute('id');
                    if (entry.isIntersecting) {
                        document.querySelectorAll('.toc a').forEach(link => {
                            link.classList.remove('active');
                        });
                        const activeLink = document.querySelector(`.toc a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, { rootMargin: '-20% 0px -80% 0px' });

            document.querySelectorAll('h2[id], h3[id]').forEach(heading => {
                observer.observe(heading);
            });
        });
    </script>
</body>

</html>